@using Microsoft.AspNetCore.Identity
@inject SignInManager<Car4You.Models.AppUser> SignInManager
@inject UserManager<Car4You.Models.AppUser> UserManager
@inject Car4You.Data.AppDbContext Db
@{
    var rentalVisible = Db.SiteSettings.FirstOrDefault(s => s.Key == "RentalVisible")?.Value == "true";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Auto Szubin</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link href="~/css/home_site.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/Car4You.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

</head>
<body>
    <div class="container">
        <main role="main" class="pb-3" style="min-height:100vh;">
            <header class="@(ViewData["AnimateMode"] ?? "load-animations") main_h">
                <div class="navbar-container">
                    <div class="navbar-top">
                        <a class="logo" href="@Url.Action("Index", "Home")">
                            <img class="logo-img" src="~/logo.png" alt="Logo" />
                        </a>
                        <div class="menu-toggle" id="menu-toggle">☰</div>
                    </div>
                    <nav id="navbar">
                        <ul>
                            <li><a href="@Url.Action("CarList", "Home")">Nasze auta</a></li>
                            @if (rentalVisible)
                            {
                                <li><a href="@Url.Action("Rental", "Home")">Wynajem autolawety</a></li>
                            }
                            <li><a href="@Url.Action("Contact", "Home")">Kontakt</a></li>
                            <li><a href="@Url.Action("About", "Home")">O nas</a></li>
                            @if (SignInManager.IsSignedIn(User) && User.IsInRole("Admin"))
                            {
                                <li><a href="@Url.Action("Index", "Admin")"><i class="fas fa-wrench"></i></a></li>
                            }
                            @if (SignInManager.IsSignedIn(User))
                            {
                                <li>
                                    <form asp-controller="Account" asp-action="Logout" method="post">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn">Wyloguj</button>
                                    </form>
</li>

                            }
                        </ul>
                    </nav>
                </div>
                <div class="line" style="height:6px; margin:0; width:100%">
                </div>
            </header>
                @RenderBody()
        </main>
    </div>
    <footer style="margin-top:2rem;">
        <div class="footer-content">
            <div class="footer-section about">
                <h2>Auto-Handel Szubin</h2>
                <p>Twoje zaufane miejsce na zakup sprawdzonego auta używanego.</p>
            </div>
            <div class="footer-section links">
                <h3>Szybkie linki</h3>
                <ul>
                    <li><a href="@Url.Action("Index", "Home")">Strona główna</a></li>
                    <li><a href="@Url.Action("CarList", "Home")">Nasze auta</a></li>
                    @if (rentalVisible)
                    {
                        <li><a href="@Url.Action("Rental", "Home")">Wynajem autolawety</a></li>
                    }
                    <li><a href="@Url.Action("Contact", "Home")">Kontakt</a></li>
                    <li><a href="#sec04">O nas</a></li>
                </ul>
            </div>
            <div class="footer-section contact">
                <h3>Kontakt</h3>
                <p><i class="fas fa-map-marker-alt"></i> <a href="https://maps.app.goo.gl/kNnncunYPW1f9b6N6" target="_blank" style="text-decoration:none; color:white;">ul. Marii Konopnickiej 49, 89-200 Szubin</a></p>
                <p><i class="fas fa-phone"></i>  +48 505 044 979</p>
                <p><i class="fas fa-envelope"></i>  kontakt@autoszubin.pl</p>
            </div>
        </div>
        <div class="bottom">
            © 2025 Auto-Handel Szubin. Wszelkie prawa zastrzeżone. <a href="@Url.Action("Privacy", "Home")">Polityka prywatności</a>
        </div>
    </footer>
    <!-- Cookie Banner (Responsive) -->
    <div id="cookieBanner" class="cookie-banner">
        <p>
            Strona używa plików cookie w celu poprawnego działania serwisu.
            <a href="/Privacy">Dowiedz się więcej</a>.
        </p>
        <button id="acceptCookies">Akceptuję</button>
    </div>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
<script>

         const menuToggle = document.getElementById("menu-toggle");
    const navbar = document.getElementById("navbar");

    if (menuToggle && navbar) {
        menuToggle.addEventListener("click", () => {
            navbar.classList.toggle("active");
        });
    }
    document.addEventListener('DOMContentLoaded', () => {

        const banner = document.getElementById('cookieBanner');
    const acceptBtn = document.getElementById('acceptCookies');

    if (!banner || !acceptBtn) return; // jeśli element nie istnieje, przerywamy

    // Sprawdź, czy użytkownik już zaakceptował
    if (!localStorage.getItem('cookiesAccepted')) {
        banner.classList.add('show'); // pokaż tylko gdy potrzeba
    }


    acceptBtn.addEventListener('click', function() {
        localStorage.setItem('cookiesAccepted', 'true');
        banner.style.display = 'none';
    });

        const header = document.querySelector('.main_h');
        const elements = document.querySelectorAll('.scroll-animate');

        const isLoadAnimations = header?.classList.contains('load-animations');
        const isScrollAnimations = header?.classList.contains('scroll-animations');

        // Ustawienie sticky dla load-animations od razu
        if (isLoadAnimations) {
            header.classList.add('sticky');
        }

        // Sticky Header dla scroll-animations
        if (!isLoadAnimations) {
            window.addEventListener('scroll', () => {
                if (!header) return;

                if (window.scrollY > 100) {
                    header.classList.add('sticky');
                } else {
                    header.classList.remove('sticky');
                }
            });
        }

        // Mobile toggle
        document.querySelector('.menu-toggle')?.addEventListener('click', () => {
            header?.classList.toggle('open-nav');
        });

        document.querySelectorAll('.main_h li a').forEach(link => {
            link.addEventListener('click', () => {
                header?.classList.remove('open-nav');
                document.querySelector('.navigation')?.classList.remove('open-nav');
            });
        });

        document.querySelectorAll('nav a').forEach(link => {
            link.addEventListener('click', (event) => {
                const id = link.getAttribute("href");
                const target = document.querySelector(id);
                if (target) {
                    const position = target.offsetTop - 70;
                    window.scrollTo({ top: position, behavior: 'smooth' });
                    event.preventDefault();
                }
            });
        });

        function onScrollAnimate() {
            elements.forEach(el => {
                const rect = el.getBoundingClientRect();
                if (rect.top < window.innerHeight - 150) {
                    el.classList.add('animated');
                }
            });
        }

        // Działa zarówno dla scroll-animations jak i load-animations
        if (isScrollAnimations || isLoadAnimations) {
            onScrollAnimate(); // Na start tylko widoczne elementy
            window.addEventListener('scroll', onScrollAnimate);
            window.addEventListener('load', onScrollAnimate);
        }

    });
</script>

