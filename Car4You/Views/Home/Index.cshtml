@model List<Car>
@{
    ViewData["Title"] = "Home";
}

<link href='https://fonts.googleapis.com/css?family=Montserrat|Cardo' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.js"></script>
<link href="~/css/home_site.css" rel="stylesheet" />


<div class="hero">

    <h1><span>SZUBIN</span><br>AUTO-HANDEL</h1>

    <h2></h2>
    <div class="line" style="height:4px; position:absolute; margin-right:-4rem; margin-left:-4rem; width:100%"></div>
</div>

<section class="section-hero">
    <div class="hero-title scroll-animate slide-up">
        <h1>Auto-Handel Szubin – Twój sprawdzony partner w zakupie auta</h1>
    </div>

    <div class="section-hero-wrapper">
        <div class="section-hero-text">
            <p class="section-hero-paragraph scroll-animate slide-up">
                Szukasz solidnego samochodu w uczciwej cenie? Dobrze trafiłeś! W Auto-Handel Szubin specjalizujemy się w sprzedaży sprawdzonych aut używanych, które przechodzą dokładną selekcję i kontrolę techniczną przed wystawieniem na sprzedaż.
                <br />
                <i class="fas fa-tools"></i> Każde auto dokładnie sprawdzamy pod względem technicznym i wizualnym<br />
                <i class="far fa-file-alt"></i> Jasna historia pojazdu – udostępniamy pełną dokumentację<br />
                <i class="fas fa-car"></i> Różnorodna oferta – samochody miejskie, rodzinne, kombi, SUV-y i nie tylko <br />
                <i class="fas fa-wrench"></i> Możliwość skorzystania z usług serwisowych i przygotowania do rejestracji <br />
                <i class="far fa-comments"></i> Zawsze możesz liczyć na uczciwe doradztwo i fachową obsługę <br />

                Z nami zyskujesz pewność zakupu i wsparcie nawet po zakupie auta. Działamy lokalnie – z pasją, doświadczeniem i dbałością o każdy detal. <br />

            <p class="section-hero-paragraph">
                <i class="fas fa-map-marker-alt"></i> Znajdziesz nas w Szubinie – zapraszamy do kontaktu i na jazdy próbne!
            </p>
        </div>
        <div class="section-hero-image scroll-animate slide-in">
            <img src="~/img-desc.jpg" class="container_img scroll-animate slide-in" style="max-width:400px;" />
        </div>
    </div>
    <a class="btn scroll-animate slide-up" href="@Url.Action("About", "Home")">Czytaj więcej</a>
</section>

<h1 class="scroll-animate slide-up">Nasze auta</h1>
<p class="scroll-animate slide-up">
    <div class="carousel-container scroll-animate slide-up">
        <button class="carousel-btn nav-btn prev" type="button">‹</button>
        <div class="carousel-track-wrapper">
            <div class="carousel-track">
                @foreach (var car in Model)
                {
                    var mainPhoto = car.Photos.FirstOrDefault(p => p.IsMain);
                    if (mainPhoto == null)
                    {
                        // możesz np. wstawić placeholder
                        mainPhoto = new Photo
                        {
                            PhotoPath = "/no-photo.png",
                            IsMain = true
                        };
                    }
                    <div class="carousel-card">
                        <div class="car-card @(car.IsHidden ? "car-card--hidden" : "")">
                            <div class="car-card__background" style="background-image: url('@mainPhoto.PhotoPath');"></div>
                            @* Nakładka dla ukrytego auta *@
                            @if (car.IsHidden)
                            {
                                <div class="car-card__overlay">UKRYTE</div>
                            }
                            <div class="car-card__info">
                                <div class="car-card__top">
                                    <div class="car-card__body-type">
                                        <img src="@Url.Content($"{car.BodyTypes.Icon}")" alt="@car.BodyTypes.Name" />
                                        <span>@car.BodyTypes.Name</span>
                                    </div>
                                    <div class="car-card__year"> <img src="~/icons/year.png" alt="Year" style="width:20px; height:20px; margin-right:5px;" />@car.Year</div>
                                </div>
                                <h2 class="car-card__title">
                                    <img src="@car.CarModel.Brand.Icon" style="width:auto; height:35px"/>
                                    @($"{car.CarModel?.Brand?.Name} {car.CarModel?.Name}" +
                                        (car.Version != null ? $" {car.Version.Name}" : ""))
                                </h2>

                                <div class="car-card__details">
                                    <div class="car-card__detail-left">

                                        <span class="value"> <img src="~/icons/petrol.png" alt="Fuel" style="width:20px; height:20px; margin-right:5px;" />@car.FuelType</span>
                                    </div>
                                    <div class="car-card__detail-right">
                                        <span class="value"><img src="~/icons/mileage.png" alt="Mileage" style="width:20px; height:20px; margin-right:5px;" />@string.Format("{0:N0}", car.Mileage) km</span>
                                    </div>
                                </div>
                                <div class="car-card__price">@string.Format("{0:N0}", car.NewPrice) PLN</div>
                                <a href="@Url.Action("Details", "Home", new { id = car.Id })" class="car-card__btn btn">Zobacz szczegóły</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
        <button class="carousel-btn nav-btn next" type="button">›</button>
    </div>

</p>
<a class="btn scroll-animate slide-up" href="@Url.Action("CarList", "Home")">Zobacz więcej</a>


@{
    var rentalMessage = TempData["RentalMessage"] as string;
}

@if (!string.IsNullOrEmpty(rentalMessage))
{
    <script>
        alert("@rentalMessage");
    </script>
}


    @section Scripts{
    <script>
                document.addEventListener('DOMContentLoaded', () => {
            const track = document.querySelector('.carousel-track');
            const prevBtn = document.querySelector('.carousel-btn.prev');
            const nextBtn = document.querySelector('.carousel-btn.next');

            let originalCards = Array.from(document.querySelectorAll('.carousel-card'));
            const cardWidth = originalCards[0].offsetWidth + 20;
            const clonesCount = 4;
            let isTransitioning = false;

            // Klonowanie kart dla zapętlenia
            for (let i = 0; i < clonesCount; i++) {
                const firstClone = originalCards[i].cloneNode(true);
                firstClone.classList.add('clone');
                track.appendChild(firstClone);

                const lastClone = originalCards[originalCards.length - 1 - i].cloneNode(true);
                lastClone.classList.add('clone');
                track.insertBefore(lastClone, track.firstChild);
            }

            let allCards = Array.from(document.querySelectorAll('.carousel-card'));
            let index = clonesCount;

            // Początkowa pozycja karuzeli
            track.style.transform = `translateX(${-index * cardWidth}px)`;

            function updateCarousel() {
                track.style.transition = 'transform 0.5s ease';
                track.style.transform = `translateX(${-index * cardWidth}px)`;
            }

            nextBtn?.addEventListener('click', () => {
                if (isTransitioning) return;
                isTransitioning = true;
                index++;
                updateCarousel();
            });

            prevBtn?.addEventListener('click', () => {
                if (isTransitioning) return;
                isTransitioning = true;
                index--;
                updateCarousel();
            });

            track.addEventListener('transitionend', () => {
                allCards = Array.from(document.querySelectorAll('.carousel-card'));

                if (index >= allCards.length - clonesCount) {
                    track.style.transition = 'none';
                    index = clonesCount;
                    track.style.transform = `translateX(${-index * cardWidth}px)`;
                } else if (index < clonesCount) {
                    track.style.transition = 'none';
                    index = allCards.length - clonesCount - 1;
                    track.style.transform = `translateX(${-index * cardWidth}px)`;
                }

                isTransitioning = false;
            });

            // --- Obsługa przeciągania palcem (touch) ---
            let startX = 0;
            let currentTranslate = -index * cardWidth;
            let isDragging = false;

            track.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isDragging = true;
                track.style.transition = 'none';
            });

            track.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                const touchX = e.touches[0].clientX;
                const diff = touchX - startX;
                track.style.transform = `translateX(${currentTranslate + diff}px)`;
            });

            track.addEventListener('touchend', (e) => {
                if (!isDragging) return;
                isDragging = false;
                const endX = e.changedTouches[0].clientX;
                const diff = endX - startX;

                // Jeśli przesunięcie większe niż 50px, zmień kartę
                if (diff < -50) { // przesunięcie w lewo → next
                    index++;
                } else if (diff > 50) { // przesunięcie w prawo → prev
                    index--;
                }
                currentTranslate = -index * cardWidth;
                updateCarousel();
            });
        });

    </script>

    }